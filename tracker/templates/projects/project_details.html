{% extends 'base.html' %}
{% load static %}

{% block title %}{{ project.title }}{% endblock %}

{% block extra_styles %}
<link rel="stylesheet" href="{% static 'tracker/css/projects.css' %}">
<link rel="stylesheet" href="{% static 'tracker/css/tickets.css' %}">
{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2 class="text-center mb-4">{{ project.title }}</h2>

    <div class="mb-3 text-center">
        <a href="{% url 'create_ticket' project.id %}" class="btn btn-sm btn-outline-primary">Create Task</a>
        <a href="{% url 'edit_project' project.id %}" class="btn btn-sm btn-outline-warning">Edit</a>
    </div>
    <div id="kanban-board" data-update-url="{% url 'update_task_status' project.id %}">
        <div class="kanban-board">
            {% for status in statuses %}
                <div class="kanban-column" data-status="{{ status.key }}">
                    <h5>{{ status.label }}</h5>
                    {% if tickets %}
                        {% for task in tickets %}
                            {% if task.status == status.key %}
                                <a href="{% url 'ticket_detail' project.id task.id %}" class="kanban-card" draggable="true" data-task-id="{{ task.id }}">
                                    <div class="fw-bold">{{ task.title }}</div>
                                    <div class="text-truncate">{{ task.description|truncatewords:15 }}</div>
                                    <div class="mt-2 d-flex justify-content-between align-items-center">
                                        <span class="badge {{ status.badge_class }}">{{ task.status|title }}</span>
                                        <span class="badge {{ status.badge_class  }}">{{ task.priority|title }}</span>
                                        <small class="text-muted">{{ task }}</small>
                                    </div>
                                </a>
                            {% endif %}
                        {% endfor %}
                    {% endif %}
                </div>
            {% endfor %}
        </div>
    </div>
</div>

<script src="{% static 'tracker/js/kanban_card.js' %}"></script>
{% endblock %}